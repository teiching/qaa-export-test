{"blocks":[{"id":"3C20B071-E9B9-423B-8DF8-7AC02CAEB60F","type":"StartBlock","disabled":false,"name":"AutomationUpdated","displayName":"Automation Updated","comment":"Configuration - set the run mode to webhook, select Qlik Cloud Services as the connector and then select the \"Automation updated event\".","childId":"61EE6296-7A3F-41E7-B09C-1FD71A3F1A8B","inputs":[{"id":"run_mode","value":"webhook","type":"select","structure":{}},{"id":"datasourcetype_guid","value":"61a87510-c7a3-11ea-95da-0fb0c241e75c","type":"select","displayValue":"Qlik Cloud Services","structure":[]},{"id":"webhook_event_guid","value":"d3958320-f77a-11ec-998f-979b98d5e4d7","type":"select","displayValue":"Automation Updated","structure":[]},{"id":"test_payload","value":"{\n  \"data\": {\n    \"id\": \"d2c39090-fd1f-11ec-999f-09b41d3ae905\",\n    \"name\": \"Qlick Cloud webhook test\",\n    \"state\": \"available\",\n    \"ownerId\": \"VgOv_nOU4N9sPkUlQ894liG6MG0Lqj0k\",\n    \"runMode\": \"manual\",\n    \"spaceId\": null,\n    \"tenantId\": \"9DNJCWjedz8Ubgiun7WfH16CjPLQj_if\",\n    \"createdAt\": \"2022-07-06T11:36:06.000000Z\",\n    \"lastRunAt\": null,\n    \"schedules\": [\n      {\n        \"id\": \"d2cac040-fd1f-11ec-924a-8123a833bf18\",\n        \"stopAt\": null,\n        \"startAt\": null,\n        \"interval\": -1,\n        \"timezone\": \"Europe/Bucharest\",\n        \"lastStartAt\": null\n      }\n    ],\n    \"updatedAt\": \"2022-07-06T11:37:23.000000Z\",\n    \"snippetIds\": [],\n    \"description\": \"test description\",\n    \"endpointIds\": [],\n    \"connectorIds\": [],\n    \"lastRunStatus\": null\n  },\n  \"source\": \"com.qlik/automations\",\n  \"eventId\": \"00b42230-fd20-11ec-b880-d547fbe222ba\",\n  \"eventTime\": \"2022-07-06T11:37:23.422Z\",\n  \"eventType\": \"com.qlik.v1.automation.updated\",\n  \"extensions\": {\n    \"userId\": \"VgOv_nOU4N9sPkUlQ894liG6MG0Lqj0k\",\n    \"ownerId\": \"VgOv_nOU4N9sPkUlQ894liG6MG0Lqj0k\",\n    \"updates\": [\n      {\n        \"path\": \"/description\",\n        \"newValue\": \"test description\",\n        \"oldValue\": null\n      },\n      {\n        \"path\": \"/createdAt\",\n        \"newValue\": \"2022-07-06T11:36:06.000000Z\",\n        \"oldValue\": \"2022-07-06T11:36:06.000000Z\"\n      },\n      {\n        \"path\": \"/updatedAt\",\n        \"newValue\": \"2022-07-06T11:37:23.000000Z\",\n        \"oldValue\": \"2022-07-06T11:36:06.000000Z\"\n      }\n    ],\n    \"tenantId\": \"9DNJCWjedz8Ubgiun7WfH16CjPLQj_if\",\n    \"description\": \"Automation updated\"\n  },\n  \"contentType\": \"application/json\",\n  \"eventTypeVersion\": \"1.0.0\",\n  \"cloudEventsVersion\": \"0.1\"\n}","type":"json","structure":[]},{"id":"webhook_documentation","value":null,"type":"string","structure":{}}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":464,"y":15,"logo":"https://cdn.qlikcloud.com/automations/logos/a2649cabda63b339ebc68a0c8d028f08.png"},{"id":"9BFBE796-3F7B-414D-8BA4-602227FF501A","type":"SnippetBlock","disabled":false,"name":"createBranch","displayName":"Git Hub - Create Branch","comment":"Specify the Owner, Repository and From Reference input parameters. The do lookup functionality is available for all.","childId":"00519E64-EB56-45D5-A295-6A09FE242212","inputs":[{"id":"9eba70d0-1ed9-11ed-9ddc-9dd0fb7fb287","value":"teiching","type":"string","displayValue":"teiching","structure":[]},{"id":"9ebbf060-1ed9-11ed-afa2-9f7291db7342","value":"qaa-export-test","type":"string","displayValue":"qaa-export-test","structure":[]},{"id":"9ebcabc0-1ed9-11ed-bcd0-df5f43c0ceea","value":"main","type":"string","structure":[]},{"id":"9ebdc940-1ed9-11ed-8015-f5fe505509e5","value":"{ $.branchName }","type":"string","structure":[]}],"settings":[{"id":"datasource","value":"572f52b6-a5fd-4b17-8672-071a5131e782","type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":584,"y":1095,"datasourcetype_guid":"0d87808f-27c0-11ea-921c-022e6b5ea1e2","snippet_guid":"9eac2bb0-1ed9-11ed-8b73-814457c25da5"},{"id":"A0A9FE9F-DDD7-421A-B67E-B71865A5318A","type":"EndpointBlock","disabled":false,"name":"getAutomation2","displayName":"Qlik Cloud Services - Get Automation 2","comment":"","childId":"F8F017D4-887F-4393-984D-0771FCA14BF6","inputs":[{"id":"637d42f0-cc60-11ec-ada3-9b34db8aacf6","value":"{$.AutomationUpdated.data.id}","type":"string","structure":[]}],"settings":[{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"cache","value":"0","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":175,"y":303,"datasourcetype_guid":"61a87510-c7a3-11ea-95da-0fb0c241e75c","endpoint_guid":"63599d90-cc60-11ec-8627-27701235d734","endpoint_role":"get"},{"id":"00519E64-EB56-45D5-A295-6A09FE242212","type":"SnippetBlock","disabled":false,"name":"CreateOrUpdateFileContent","displayName":"Git Hub - Create Or Update File Content","comment":"Specify the User and Repo parameters. The do lookup functionality is available for both.","childId":"901B47D5-2A82-48E4-BB77-A5CB7158DBC8","inputs":[{"id":"70b4a4c0-4074-11ec-a8e6-c1dc761dcfb1","value":"teiching","type":"string","structure":[]},{"id":"70b5c000-4074-11ec-969e-792346f99f92","value":"qaa-export-test","type":"string","displayValue":"qaa-export-test","structure":[]},{"id":"70b63220-4074-11ec-b55b-7725e494603a","value":"automation.json","type":"string","structure":[]},{"id":"b27fff40-4074-11ec-9f16-55d8428ec62c","value":"{ $.branchName }","type":"string","structure":[]},{"id":"70b75130-4074-11ec-84ab-e102a3b0c185","value":"new version for the automation modified on { $.AutomationUpdated.data.updatedAt }","type":"string","structure":[]},{"id":"70b84f80-4074-11ec-9358-b5650774d83c","value":"{base64encode: {json: {$.automationExport}}}","type":"string","structure":[]},{"id":"09cb4810-1675-11ef-b5b9-9d279f1efa08","value":null,"type":"string","structure":[]},{"id":"09cc0110-1675-11ef-ad79-4d7c92bf3de3","value":null,"type":"string","structure":[]}],"settings":[{"id":"datasource","value":"572f52b6-a5fd-4b17-8672-071a5131e782","type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":489,"y":1252,"datasourcetype_guid":"0d87808f-27c0-11ea-921c-022e6b5ea1e2","snippet_guid":"70a930c0-4074-11ec-9bb6-b36e27de5d04"},{"id":"901B47D5-2A82-48E4-BB77-A5CB7158DBC8","type":"EndpointBlock","disabled":false,"name":"createPullRequest","displayName":"GitHub - Create Pull Request","comment":"Specify the Owner, Repo and Target Branch input parameters. The do lookup functionality is available for all.","childId":null,"inputs":[{"id":"e6e87240-1ee9-11ed-9d00-3785e1aca73f","value":"teiching","type":"string","structure":[]},{"id":"e6f18960-1ee9-11ed-a46e-e3baf7e46151","value":"qaa-export-test","type":"string","structure":[]},{"id":"e70e78b0-1ee9-11ed-89bc-3fb25bbea0b0","value":"{ $.branchName }","type":"string","structure":[]},{"id":"e7178460-1ee9-11ed-aac4-5b2648b3e3c2","value":"{ $.branchName }","type":"string","structure":[]},{"id":"774a7250-1eea-11ed-a20f-79bf2609fe81","value":"main","type":"string","structure":[]},{"id":"a5267490-1eea-11ed-a4d8-f5ddd930d117","value":"Please merge.","type":"longtext","structure":[]}],"settings":[{"id":"datasource","value":"572f52b6-a5fd-4b17-8672-071a5131e782","type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":220,"y":1368,"datasourcetype_guid":"0d87808f-27c0-11ea-921c-022e6b5ea1e2","endpoint_guid":"e6b09740-1ee9-11ed-8cef-637581512ebf","endpoint_role":"create"},{"id":"651FD3EB-499C-40DA-AFC4-E412E9435129","type":"IfElseBlock","disabled":false,"name":"condition2","displayName":"Condition 2","comment":"Checking to see if updated automation is the same as the source automation.","childId":null,"inputs":[{"id":"conditions","value":{"mode":"all","conditions":[{"input1":"{$.AutomationUpdated.data.id}","input2":"{$.automationId}","operator":"="}]},"type":"custom","structure":[]}],"settings":[],"collapsed":[{"name":"yes","isCollapsed":false},{"name":"no","isCollapsed":true}],"x":100,"y":700,"childTrueId":"A0A9FE9F-DDD7-421A-B67E-B71865A5318A","childFalseId":null},{"id":"61EE6296-7A3F-41E7-B09C-1FD71A3F1A8B","type":"VariableBlock","disabled":false,"name":"automationId","displayName":"Variable - automationId","comment":"Configuration - Specify the id of the source automation.","childId":"123AA271-CB44-4B39-87AA-E1D2BE72EC7F","inputs":[],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":104,"y":184,"variableGuid":"16225039-03BD-4646-8349-89DAFAC38DD3","operations":[{"id":"set_value","key":"0B4DED7B-15C3-4CEC-9B2F-B6E217A99B3E","name":"Set value of { variable }","value":"68883b9f-6915-4445-88a0-40ab34928966"}]},{"id":"64D0FC6B-DC05-42E0-AB70-26A058076A3A","type":"IfElseBlock","disabled":false,"name":"condition","displayName":"Condition","comment":"Checking to see if the automationId has been filled in.","childId":"651FD3EB-499C-40DA-AFC4-E412E9435129","inputs":[{"id":"conditions","value":{"mode":"all","conditions":[{"input1":"{$.automationId}","input2":null,"operator":"empty"}]},"type":"custom","structure":[]}],"settings":[],"collapsed":[{"name":"yes","isCollapsed":false},{"name":"no","isCollapsed":true}],"x":97,"y":404,"childTrueId":"1DEF0EAC-8346-49DF-8E30-2734AC9FB268","childFalseId":null},{"id":"1DEF0EAC-8346-49DF-8E30-2734AC9FB268","type":"ErrorBlock","disabled":false,"name":"error","displayName":"Error","comment":"Alert the user and stop the automation.","childId":null,"inputs":[{"id":"message","value":"Variable \"automationId\" is empty.","type":"string","structure":[]},{"id":"action","value":"stop","type":"select","structure":[]}],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":209,"y":544},{"id":"123AA271-CB44-4B39-87AA-E1D2BE72EC7F","type":"VariableBlock","disabled":false,"name":"branchName","displayName":"Variable - branchName","comment":"Variable for the name of the new branch with date suffix. Feel free to customize this, branch names must be unique.","childId":"64D0FC6B-DC05-42E0-AB70-26A058076A3A","inputs":[],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":464,"y":255,"variableGuid":"A2B5F577-A5E0-4413-8131-B23AA54E1686","operations":[{"id":"set_value","key":"B30B5D0F-1466-44F6-9BD0-7013B1D0C49A","name":"Set value of { variable }","value":"updateAutomation-{date: {$.AutomationUpdated.data.updatedAt}, 'U'}"}]},{"id":"F8F017D4-887F-4393-984D-0771FCA14BF6","type":"VariableBlock","disabled":false,"name":"automationExport","displayName":"Variable - automationExport","comment":"Transform automation content to JSON object.","childId":"9BFBE796-3F7B-414D-8BA4-602227FF501A","inputs":[],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":220,"y":900,"variableGuid":"49212122-DA91-4A33-BC9F-3DB598475744","operations":[{"id":"empty","key":"8CB560FD-56F9-4B77-9AA5-43A4080EB6A2","name":"Empty { variable }","value":null},{"id":"set_key_value","key":"102CF217-FC75-435F-94AE-28CFE795C30E","name":"Set key/values of { variable }","value":[{"key":"name","value":"{$.getAutomation2.name}"},{"key":"description","value":"{$.getAutomation2.description}"},{"key":"workspace","value":"{$.getAutomation2.workspace}"},{"key":"schedules","value":"{$.getAutomation2.schedules}"}]}]}],"variables":[{"guid":"A2B5F577-A5E0-4413-8131-B23AA54E1686","name":"branchName","type":"string"},{"guid":"16225039-03BD-4646-8349-89DAFAC38DD3","name":"automationId","type":"string"},{"guid":"5DAA237A-1ACA-4A91-8009-7F88CC5F9C18","name":"repositoryName","type":"string"},{"guid":"14272657-EC1A-4368-ACA3-3FC73E60DE5D","name":"mainBranchName","type":"string"},{"guid":"7F7D1DED-7E06-4FF8-B088-93075F915CE1","name":"repositoryOwner","type":"string"},{"guid":"49212122-DA91-4A33-BC9F-3DB598475744","name":"automationExport","type":"object"}]}